# ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–∫–∞–∑–∞—Ö

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ Django –ø—Ä–æ–µ–∫—Ç–µ:

1. ‚úîÔ∏è –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `TelegramAdmin` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
2. ‚úîÔ∏è –°–µ—Ä–≤–∏—Å `TelegramNotificationService` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
3. ‚úîÔ∏è Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
4. ‚úîÔ∏è API endpoint `/api/orders/telegram/register/` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
5. ‚úîÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏

---

## üìã –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

```bash
python manage.py makemigrations orders
python manage.py migrate
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –±–æ—Ç–∞

```bash
pip install -r telegram_bot_requirements.txt
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
pip install aiogram==3.15.0 python-dotenv requests
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —Ñ–∞–π–ª–µ –µ—Å—Ç—å:

```env
# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞ (—É–∂–µ –µ—Å—Ç—å)
TELEGRAM_BOT_TOKEN=7624631239:AAF5H8G7rCL7Va2TbfDQjvIFb309xEdcTbs

# URL –≤–∞—à–µ–≥–æ Django API (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
DJANGO_API_URL=http://127.0.0.1:8000

# –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL:
# DJANGO_API_URL=https://flori-craft-backend-production.up.railway.app
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ Django —Å–µ—Ä–≤–µ—Ä

```bash
python manage.py runserver
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ Telegram –±–æ—Ç–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)

```bash
python telegram_bot.py
```

### –®–∞–≥ 6: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ë–æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–∞—Å –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start ‚Üí Telegram –±–æ—Ç ‚Üí API Django ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
                                          ‚Üì
                                   –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ chat_id
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```
–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Üí –Æ–ö–∞—Å—Å–∞ webhook ‚Üí Django ‚Üí TelegramNotificationService
                                             ‚Üì
                                    –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
```

---

## üì± –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä |
| `/help` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É |
| `/status` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `/chatid` | –£–∑–Ω–∞—Ç—å —Å–≤–æ–π Chat ID |

---

## üé® –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

```
üéâ –ù–û–í–´–ô –ó–ê–ö–ê–ó #123

üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ:
üí∞ –°—É–º–º–∞: 5000 ‚ÇΩ
üöö –î–æ—Å—Ç–∞–≤–∫–∞: 500 ‚ÇΩ
üí≥ ID –ø–ª–∞—Ç–µ–∂–∞: 2d3f7b8e-...

üë§ –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:
‚Ä¢ –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +79991234567

üéÅ –ü–æ–ª—É—á–∞—Ç–µ–ª—å:
‚Ä¢ –ò–º—è: –ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +79997654321

üöö –î–æ—Å—Ç–∞–≤–∫–∞:
‚Ä¢ –ê–¥—Ä–µ—Å: –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 10 (–∫–≤. 25, –ø–æ–¥—ä–µ–∑–¥ 2, —ç—Ç–∞–∂ 5)
‚Ä¢ –†–∞–π–æ–Ω: Fili
‚Ä¢ –î–∞—Ç–∞: 2026-02-15
‚Ä¢ –í—Ä–µ–º—è: 14:00-16:00

üõçÔ∏è –¢–æ–≤–∞—Ä—ã:
  ‚Ä¢ –ë—É–∫–µ—Ç —Ä–æ–∑ (L) - 3500 ‚ÇΩ
  ‚Ä¢ –û—Ç–∫—Ä—ã—Ç–∫–∞ - 200 ‚ÇΩ

üíå –¢–µ–∫—Å—Ç –æ—Ç–∫—Ä—ã—Ç–∫–∏:
–° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è!
```

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏:

### –ß–µ—Ä–µ–∑ Django Admin:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `http://127.0.0.1:8000/admin/`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Orders" ‚Üí "Telegram –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã"
3. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ:
   - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
   - –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (is_active = False)
   - –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ß–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```python
from apps.orders.models import TelegramAdmin

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
admins = TelegramAdmin.objects.all()

# –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
admin = TelegramAdmin.objects.get(chat_id=123456789)
admin.is_active = False
admin.save()

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
admin.is_active = True
admin.save()
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### 1. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```bash
curl -X POST http://127.0.0.1:8000/api/orders/telegram/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": 123456789,
    "username": "testuser",
    "first_name": "Test",
    "last_name": "User"
  }'
```

### 2. –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ API
2. –û–ø–ª–∞—Ç–∏—Ç–µ –µ–≥–æ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π webhook)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –≤ Telegram

---

## üöÄ Production deployment:

### –î–ª—è Railway/Render/etc:

1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```
   DJANGO_API_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

3. –î–ª—è Render/Railway –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Procfile:
   ```
   web: gunicorn FloriCraft.wsgi
   bot: python telegram_bot.py
   ```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

- **Chat ID –Ω–µ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é** - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `/start`
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è** - –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - webhook –æ—Ç –Æ–ö–∞—Å—Å—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç IP –∞–¥—Ä–µ—Å–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º

---

## ‚ùì Troubleshooting:

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω: `python telegram_bot.py`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `.env`

### –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `is_active=True` –≤ –∞–¥–º–∏–Ω–∫–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django: `tail -f logs/django.log`

### –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Django —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DJANGO_API_URL` –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint: `curl http://127.0.0.1:8000/api/orders/telegram/register/`

---

## üìö –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `telegram_bot.py` | –ö–æ–¥ Telegram –±–æ—Ç–∞ –Ω–∞ aiogram |
| `apps/orders/telegram_service.py` | –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `apps/orders/models.py` | –ú–æ–¥–µ–ª—å TelegramAdmin |
| `apps/orders/views.py` | API –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ |
| `apps/orders/admin.py` | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |

### API Endpoints:

- `POST /api/orders/telegram/register/` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `POST /api/orders/webhook/` - Webhook –æ—Ç –Æ–ö–∞—Å—Å—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

–¢–∞–±–ª–∏—Ü–∞ `orders_telegramadmin`:
```sql
CREATE TABLE orders_telegramadmin (
    id SERIAL PRIMARY KEY,
    chat_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–∞–∂–¥–æ–º –æ–ø–ª–∞—á–µ–Ω–Ω–æ–º –∑–∞–∫–∞–∑–µ –≤ Telegram!
