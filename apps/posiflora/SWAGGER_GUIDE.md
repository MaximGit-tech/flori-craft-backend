# Swagger/OpenAPI –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö API endpoints –ø—Ä–æ–µ–∫—Ç–∞ FloriCraft.

## –î–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º URL:

### 1. Swagger UI (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
```
http://localhost:8000/api/docs/
```
Swagger UI - —ç—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ endpoints
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –í–∏–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∏ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏

### 2. ReDoc (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
```
http://localhost:8000/api/redoc/
```
ReDoc - —ç—Ç–æ –∫—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é –¥–ª—è –±–æ–ª—å—à–∏—Ö API.

### 3. OpenAPI Schema (JSON)
```
http://localhost:8000/api/schema/
```
–°—ã—Ä–∞—è OpenAPI —Å—Ö–µ–º–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö.

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Swagger UI

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:8000/api/docs/`

### –®–∞–≥ 2: –ü—Ä–æ—Å–º–æ—Ç—Ä endpoints

–í—Å–µ endpoints —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ç–µ–≥–∞–º:
- **Posiflora Products** - —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏–∑ Posiflora
- **Cart** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π
- **Auth** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ endpoint

1. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ endpoint, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Try it out"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–µ—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è)
4. –ù–∞–∂–º–∏—Ç–µ **"Execute"**
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞

### –®–∞–≥ 4: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

–ï—Å–ª–∏ endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–ª–∏ credentials
3. –ù–∞–∂–º–∏—Ç–µ **"Authorize"**
4. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã

**Endpoint:** `GET /api/posiflora/products/`

**–í Swagger UI:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ–∫—Ü–∏—é "Posiflora Products"
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ `GET /api/posiflora/products/`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - `public_only`: true/false
   - `on_window`: true/false
5. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "products": [
    {
      "id": "12345",
      "name": "–†–æ–∑–∞ –∫—Ä–∞—Å–Ω–∞—è 50—Å–º",
      "description": "–ö—Ä–∞—Å–∏–≤–∞—è –∫—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞",
      "sku": "ROSE-RED-50",
      "price": "150.00",
      "currency": "RUB",
      "available": true,
      "image_url": "https://example.com/image.jpg",
      "category": "–†–æ–∑—ã",
      "item_type": "flower",
      "price_min": "150.00",
      "price_max": "150.00"
    }
  ],
  "count": 1247
}
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID

**Endpoint:** `GET /api/posiflora/products/{product_id}/`

**–í Swagger UI:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ–∫—Ü–∏—é "Posiflora Products"
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ `GET /api/posiflora/products/{product_id}/`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –í–≤–µ–¥–∏—Ç–µ `product_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä: "12345")
5. –ù–∞–∂–º–∏—Ç–µ "Execute"

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

### Postman

1. –°–∫–∞—á–∞–π—Ç–µ OpenAPI —Å—Ö–µ–º—É: `http://localhost:8000/api/schema/`
2. –í Postman: File ‚Üí Import ‚Üí Raw text
3. –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ö–µ–º—ã
4. –ì–æ—Ç–æ–≤–æ! –í—Å–µ endpoints –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Postman

### Insomnia

1. –°–∫–∞—á–∞–π—Ç–µ OpenAPI —Å—Ö–µ–º—É: `http://localhost:8000/api/schema/`
2. –í Insomnia: Create ‚Üí Import from File
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å—Ö–µ–º—ã
4. –ì–æ—Ç–æ–≤–æ!

### curl

–ò–∑ Swagger UI –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É curl:
1. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤ Swagger UI
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é "Curl"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É

–ü—Ä–∏–º–µ—Ä:
```bash
curl -X 'GET' \
  'http://localhost:8000/api/posiflora/products/?public_only=true' \
  -H 'accept: application/json'
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `settings.py`:

```python
SPECTACULAR_SETTINGS = {
    'TITLE': 'FloriCraft API',
    'DESCRIPTION': 'API –¥–ª—è —Ü–≤–µ—Ç–æ—á–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ FloriCraft',
    'VERSION': '1.0.0',
    'SERVE_INCLUDE_SCHEMA': False,
    'COMPONENT_SPLIT_REQUEST': True,
    'SCHEMA_PATH_PREFIX': '/api/',
    'SWAGGER_UI_SETTINGS': {
        'deepLinking': True,
        'persistAuthorization': True,
        'displayOperationId': True,
    },
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ –Ω–æ–≤—ã–º endpoints

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ view –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@extend_schema`:

```python
from drf_spectacular.utils import extend_schema, OpenApiParameter
from drf_spectacular.types import OpenApiTypes

class MyView(APIView):
    @extend_schema(
        summary="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
        description="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ endpoint",
        parameters=[
            OpenApiParameter(
                name='my_param',
                type=OpenApiTypes.STR,
                location=OpenApiParameter.QUERY,
                description='–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞',
                required=False,
            ),
        ],
        responses={
            200: MySerializer,
            400: {'description': 'Bad Request'}
        },
        tags=['My Tag'],
    )
    def get(self, request):
        pass
```

---

## Troubleshooting

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** 404 –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/api/docs/`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `drf-spectacular` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `pip list | grep drf-spectacular`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `INSTALLED_APPS` –≤ settings.py - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `'drf_spectacular'`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `REST_FRAMEWORK` –≤ settings.py - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema'`

### Endpoints –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ endpoints

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ views –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç DRF –∫–ª–∞—Å—Å–æ–≤ (APIView, ViewSet, etc.)
2. –î–æ–±–∞–≤—å—Ç–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@extend_schema` –∫ –º–µ—Ç–æ–¥–∞–º view
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URLs –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ –≥–ª–∞–≤–Ω–æ–º urls.py

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/api/schema/`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ serializers - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ import'—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `python manage.py spectacular --file schema.yml --validate`

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [drf-spectacular –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://drf-spectacular.readthedocs.io/)
- [OpenAPI Specification](https://swagger.io/specification/)
- [Swagger UI](https://swagger.io/tools/swagger-ui/)
- [ReDoc](https://redocly.com/redoc/)

---

## –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

```python
from drf_spectacular.utils import extend_schema

class ProductView(APIView):
    @extend_schema(
        summary="–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã",
        tags=['Products'],
    )
    def get(self, request):
        return Response({"products": []})
```

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

```python
from drf_spectacular.utils import extend_schema, OpenApiParameter, OpenApiExample
from drf_spectacular.types import OpenApiTypes

class ProductView(APIView):
    @extend_schema(
        summary="–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã",
        description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π",
        parameters=[
            OpenApiParameter(
                name='category',
                type=OpenApiTypes.STR,
                location=OpenApiParameter.QUERY,
                description='–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
                required=False,
                examples=[
                    OpenApiExample('–†–æ–∑—ã', value='roses'),
                    OpenApiExample('–¢—é–ª—å–ø–∞–Ω—ã', value='tulips'),
                ]
            ),
        ],
        responses={
            200: ProductSerializer(many=True),
            400: {'description': 'Invalid parameters'}
        },
        tags=['Products'],
        examples=[
            OpenApiExample(
                '–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç',
                value={'products': [{'id': '1', 'name': '–†–æ–∑–∞'}]},
                response_only=True,
            ),
        ]
    )
    def get(self, request):
        return Response({"products": []})
```

---

–¢–µ–ø–µ—Ä—å –≤–∞—à API –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
